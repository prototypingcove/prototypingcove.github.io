# Enhanced Nginx Configuration for Performance and Mobile Optimization

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml
    application/json
    application/ld+json;

# Browser caching
location ~* \.(css|js|woff|woff2|ttf|eot|svg|ico|png|jpg|jpeg|gif|webp)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header Vary Accept-Encoding;
}

# HTML caching
location ~* \.html$ {
    expires 1h;
    add_header Cache-Control "public";
}

# Security headers
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "no-referrer-when-downgrade" always;

# Content Security Policy (adjust as needed)
add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

# Preconnect hints for external resources
add_header Link "</wp-content/themes/astra/assets/fonts/astra.woff2>; rel=preload; as=font; type=font/woff2; crossorigin" always;
add_header Link "<https://fonts.googleapis.com>; rel=preconnect" always;
add_header Link "<https://fonts.gstatic.com>; rel=preconnect; crossorigin" always;

# Existing rules (preserved)
error_page 404 /404_not_found/index.html;
location ~ ^/404_not_found/$ { internal; }
location ~ ^/wp-includes/js/jquery/jquery.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-includes/js/jquery/jquery-migrate.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/js/v4-shims.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/themes/astra/assets/js/minified/frontend.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-includes/js/dist/dom-ready.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/astra-sites/inc/lib/onboarding/assets/dist/template-preview/main.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/easy-fancybox/vendor/purify.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/easy-fancybox/fancybox/1.5.4/jquery.fancybox.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/easy-fancybox/vendor/jquery.easing.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/pro-elements/assets/js/webpack-pro.runtime.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/easy-fancybox/vendor/jquery.mousewheel.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/elementor/assets/js/webpack.runtime.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/elementor/assets/js/frontend-modules.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-includes/js/dist/hooks.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-includes/js/dist/i18n.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/pro-elements/assets/js/frontend.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-includes/js/jquery/ui/core.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/pro-elements/assets/js/elements-handlers.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/plugins/elementor/assets/js/frontend.min.js$ { types { } default_type "application/x-javascript"; }
location ~ ^/wp-content/themes/astra/assets/fonts/astra.woff$ { types { } default_type "application/font-woff"; }
location ~ ^/wp-content/themes/astra/assets/fonts/astra.ttf$ { types { } default_type "application/font-sfnt"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-brands-400.woff2$ { types { } default_type "application/font-woff2"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-brands-400.woff$ { types { } default_type "application/font-woff"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-brands-400.ttf$ { types { } default_type "application/font-sfnt"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-regular-400.woff2$ { types { } default_type "application/font-woff2"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-regular-400.woff$ { types { } default_type "application/font-woff"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-regular-400.ttf$ { types { } default_type "application/font-sfnt"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-solid-900.woff2$ { types { } default_type "application/font-woff2"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-solid-900.woff$ { types { } default_type "application/font-woff"; }
location ~ ^/wp-content/plugins/elementor/assets/lib/font-awesome/webfonts/fa-solid-900.ttf$ { types { } default_type "application/font-sfnt"; }
